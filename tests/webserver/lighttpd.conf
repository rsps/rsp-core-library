var.basedir = "/tmp/rsp"

server.modules += ("mod_openssl")

server.document-root = basedir + "/pages/"

server.port = 8443
server.name = "server.localhost"
ssl.pemfile = basedir + "/certs/server.pem"
ssl.engine  = "enable"
ssl.ca-file = basedir + "/ca/ca.pem"

ssl.openssl.ssl-conf-cmd = ("MinProtocol" => "TLSv1.3",
                            "Options" => "-ServerPreference")

server.username = "www-data"
server.groupname = "www-data"

mimetype.assign = (
    ".html" => "text/html",
    ".txt" => "text/plain",
    ".json" => "application/json",
    ".jpg" => "image/jpeg",
    ".png" => "image/png"
)

server.errorlog = basedir + "/logs/error.log"
debug.log-request-handling = "enable"

static-file.exclude-extensions = ( ".fcgi", ".php", ".rb", "~", ".inc" )
index-file.names = ( "index.html" )

$HTTP["host"] == "server.localhost" {
    server.document-root = basedir + "/pages/"
}

$SERVER["socket"] == ":44300" {
    ssl.verifyclient.exportcert = "enable"
    ssl.verifyclient.activate   = "enable"
    ssl.verifyclient.username   = "SSL_CLIENT_S_DN_CN"
    ssl.verifyclient.enforce    = "enable"
    ssl.verifyclient.depth      = 3
}
